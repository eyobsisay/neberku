{% extends 'core/base.html' %}

{% block title %}Event Owner Dashboard - Neberku{% endblock %}

{% block navigation %}
<li class="nav-item">
    <a class="nav-link" href="#dashboard">Dashboard</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="#events">My Events</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="#guests">Guests</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="#media">Media</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="#settings">Settings</a>
</li>
<li class="nav-item">
    <a class="nav-link" href="#" onclick="logout()">Logout</a>
</li>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-4 fw-bold">Welcome to Your Event Dashboard</h1>
                <p class="lead">Manage your events, review guest contributions, and create unforgettable memories.</p>
                <button class="btn btn-light btn-lg" data-bs-toggle="modal" data-bs-target="#createEventModal">
                    <i class="bi bi-plus-circle"></i> Create New Event
                </button>
            </div>
            <div class="col-lg-4 text-center">
                <i class="bi bi-calendar-event" style="font-size: 8rem; opacity: 0.8;"></i>
            </div>
        </div>
    </div>
</section>

<!-- Dashboard Stats -->
<section id="dashboard" class="py-5">
    <div class="container">
        <h2 class="text-center mb-5">Dashboard Overview</h2>
        <div class="row g-4">
            <div class="col-md-3">
                <div class="card text-center card-hover">
                    <div class="card-body">
                        <i class="bi bi-calendar-check text-primary" style="font-size: 2rem;"></i>
                        <h5 class="card-title mt-3">Active Events</h5>
                        <h3 class="text-primary" id="activeEventsCount">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center card-hover">
                    <div class="card-body">
                        <i class="bi bi-people text-success" style="font-size: 2rem;"></i>
                        <h5 class="card-title mt-3">Total Guests</h5>
                        <h3 class="text-success" id="totalGuestsCount">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center card-hover">
                    <div class="card-body">
                        <i class="bi bi-image text-info" style="font-size: 2rem;"></i>
                        <h5 class="card-title mt-3">Photos</h5>
                        <h3 class="text-info" id="totalPhotosCount">0</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center card-hover">
                    <div class="card-body">
                        <i class="bi bi-camera-video text-warning" style="font-size: 2rem;"></i>
                        <h5 class="card-title mt-3">Videos</h5>
                        <h3 class="text-warning" id="totalVideosCount">0</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- My Events Section -->
<section id="events" class="py-5 bg-light">
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>My Events</h2>
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createEventModal">
                <i class="bi bi-plus-circle"></i> New Event
            </button>
        </div>
        <div class="row g-4" id="eventsContainer">
            <!-- Events will be loaded here dynamically -->
        </div>
    </div>
</section>

<!-- Guest Posts Section -->
<section id="guests" class="py-5">
    <div class="container">
        <h2 class="mb-4">Recent Guest Contributions</h2>
        <div class="row g-4" id="guestPostsContainer">
            <!-- Guest posts will be loaded here dynamically -->
        </div>
    </div>
</section>

<!-- Media Management Section -->
<section id="media" class="py-5 bg-light">
    <div class="container">
        <h2 class="mb-4">Media Management</h2>
        <div class="row g-4" id="mediaContainer">
            <!-- Media files will be loaded here dynamically -->
        </div>
    </div>
</section>

<!-- Create Event Modal -->
<div class="modal fade" id="createEventModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Create New Event</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createEventForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="eventTitle" class="form-label">Event Title *</label>
                            <input type="text" class="form-control" id="eventTitle" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="eventType" class="form-label">Event Type *</label>
                            <select class="form-select" id="eventType" required>
                                <option value="">Select Event Type</option>
                            </select>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="eventDate" class="form-label">Event Date *</label>
                            <input type="date" class="form-control" id="eventDate" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="eventLocation" class="form-label">Location</label>
                            <input type="text" class="form-control" id="eventLocation">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="eventDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="eventDescription" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="allowPhotos" checked>
                                <label class="form-check-label" for="allowPhotos">Allow Photos</label>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="allowVideos" checked>
                                <label class="form-check-label" for="allowVideos">Allow Videos</label>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="allowWishes" checked>
                                <label class="form-check-label" for="allowWishes">Allow Wishes</label>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="isPublic">
                                <label class="form-check-label" for="isPublic">Public Event (Discoverable)</label>
                                <div class="form-text">Check to make this event discoverable in public listings</div>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="eventThumbnail" class="form-label">Event Thumbnail</label>
                        <input type="file" class="form-control" id="eventThumbnail" accept="image/*">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="createEvent()">Create Event</button>
            </div>
        </div>
    </div>
</div>

<!-- Event Details Modal -->
<div class="modal fade" id="eventDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Event Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="eventDetailsContent">
                <!-- Event details will be loaded here -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Global variables
let currentUser = null;
let events = [];
let guestPosts = [];
let mediaFiles = [];

// Initialize dashboard
document.addEventListener('DOMContentLoaded', function() {
    loadDashboardData();
    loadEventTypes();
});

// Load events for the current user
async function loadEvents() {
    try {
        const response = await fetch('/api/events/', {
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include'
        });
        
        if (response.ok) {
            events = await response.json();
            displayEvents();
            updateDashboardStats();
        }
    } catch (error) {
        console.error('Error loading events:', error);
    }
}

// Load dashboard data
async function loadDashboardData() {
    try {
        // Load events
        const eventsResponse = await fetch('/api/events/', {
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include'  // Include cookies for session authentication
        });
        
        if (eventsResponse.ok) {
            events = await eventsResponse.json();
            displayEvents();
            updateDashboardStats();
        }
        
        // Load guest posts
        await loadGuestPosts();
        
        // Load media files
        await loadMediaFiles();
        
    } catch (error) {
        console.error('Error loading dashboard data:', error);
        showAlert('Error loading dashboard data', 'danger');
    }
}

// Load event types for the create form
async function loadEventTypes() {
    try {
        const response = await fetch('/api/event-types/');
        if (response.ok) {
            const eventTypes = await response.json();
            const select = document.getElementById('eventType');
            eventTypes.forEach(type => {
                const option = document.createElement('option');
                option.value = type.id;
                option.textContent = type.name;
                select.appendChild(option);
            });
        }
    } catch (error) {
        console.error('Error loading event types:', error);
    }
}

// Display events
function displayEvents() {
    const container = document.getElementById('eventsContainer');
    container.innerHTML = '';
    
    if (events.length === 0) {
        container.innerHTML = `
            <div class="col-12 text-center">
                <div class="card">
                    <div class="card-body">
                        <i class="bi bi-calendar-x text-muted" style="font-size: 3rem;"></i>
                        <h5 class="mt-3">No Events Yet</h5>
                        <p class="text-muted">Create your first event to get started!</p>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createEventModal">
                            Create Event
                        </button>
                    </div>
                </div>
            </div>
        `;
        return;
    }
    
    events.forEach(event => {
        const eventCard = createEventCard(event);
        container.appendChild(eventCard);
    });
}

// Create event card
function createEventCard(event) {
    const col = document.createElement('div');
    col.className = 'col-lg-6 col-xl-4';
    
    const statusBadge = getStatusBadge(event.status, event.payment_status);
    const isLive = event.is_live ? '<span class="badge bg-success ms-2">Live</span>' : '';
    
    col.innerHTML = `
        <div class="card card-hover h-100">
            ${event.event_thumbnail ? 
                `<img src="${event.event_thumbnail}" class="card-img-top" alt="${event.title}" style="height: 200px; object-fit: cover;">` :
                `<div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                    <i class="bi bi-calendar-event text-muted" style="font-size: 3rem;"></i>
                </div>`
            }
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h5 class="card-title">${event.title}</h5>
                    ${statusBadge}${isLive}
                </div>
                <p class="card-text text-muted">${event.description || 'No description'}</p>
                <div class="row text-center mb-3">
                    <div class="col-4">
                        <small class="text-muted">Guests</small>
                        <div class="fw-bold">${event.total_guest_posts || 0}</div>
                    </div>
                    <div class="col-4">
                        <small class="text-muted">Photos</small>
                        <div class="fw-bold">${event.total_media_files ? event.total_media_files.filter(m => m.media_type === 'photo').length : 0}</div>
                    </div>
                    <div class="col-4">
                        <small class="text-muted">Videos</small>
                        <div class="fw-bold">${event.total_media_files ? event.total_media_files.filter(m => m.media_type === 'video').length : 0}</div>
                    </div>
                </div>
                <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary btn-sm" onclick="viewEventDetails(${event.id})">
                        <i class="bi bi-eye"></i> View Details
                    </button>
                    <button class="btn btn-outline-secondary btn-sm" onclick="viewEventGallery(${event.id})">
                        <i class="bi bi-images"></i> Gallery
                    </button>
                </div>
            </div>
            <div class="card-footer text-muted">
                <small>${new Date(event.event_date).toLocaleDateString()}</small>
            </div>
        </div>
    `;
    
    return col;
}

// Get status badge
function getStatusBadge(status, paymentStatus) {
    if (paymentStatus === 'paid' && status === 'active') {
        return '<span class="badge bg-success">Active</span>';
    } else if (paymentStatus === 'pending') {
        return '<span class="badge bg-warning">Payment Pending</span>';
    } else if (status === 'draft') {
        return '<span class="badge bg-secondary">Draft</span>';
    } else {
        return '<span class="badge bg-info">' + status.charAt(0).toUpperCase() + status.slice(1) + '</span>';
    }
}

// Update dashboard stats
function updateDashboardStats() {
    const activeEvents = events.filter(e => e.status === 'active' && e.payment_status === 'paid').length;
    const totalGuests = events.reduce((sum, e) => sum + (e.total_guest_posts || 0), 0);
    const totalPhotos = events.reduce((sum, e) => {
        if (e.total_media_files) {
            return sum + e.total_media_files.filter(m => m.media_type === 'photo').length;
        }
        return sum;
    }, 0);
    const totalVideos = events.reduce((sum, e) => {
        if (e.total_media_files) {
            return sum + e.total_media_files.filter(m => m.media_type === 'video').length;
        }
        return sum;
    }, 0);
    
    document.getElementById('activeEventsCount').textContent = activeEvents;
    document.getElementById('totalGuestsCount').textContent = totalGuests;
    document.getElementById('totalPhotosCount').textContent = totalPhotos;
    document.getElementById('totalVideosCount').textContent = totalVideos;
}

// Load guest posts
async function loadGuestPosts() {
    try {
        const response = await fetch('/api/guest-posts/', {
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include'
        });
        
        if (response.ok) {
            guestPosts = await response.json();
            displayGuestPosts();
        }
    } catch (error) {
        console.error('Error loading guest posts:', error);
    }
}

// Display guest posts
function displayGuestPosts() {
    const container = document.getElementById('guestPostsContainer');
    container.innerHTML = '';
    
    if (guestPosts.length === 0) {
        container.innerHTML = `
            <div class="col-12 text-center">
                <p class="text-muted">No guest contributions yet.</p>
            </div>
        `;
        return;
    }
    
    // Show only recent posts (limit to 6)
    const recentPosts = guestPosts.slice(0, 6);
    
    recentPosts.forEach(post => {
        const postCard = createGuestPostCard(post);
        container.appendChild(postCard);
    });
}

// Create guest post card
function createGuestPostCard(post) {
    const col = document.createElement('div');
    col.className = 'col-lg-6 col-xl-4';
    
    const mediaPreview = post.media_files && post.media_files.length > 0 ? 
        `<img src="${post.media_files[0].media_file}" class="media-preview mb-3" alt="Media preview">` : '';
    
    col.innerHTML = `
        <div class="card card-hover h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6 class="card-title">${post.guest_name}</h6>
                    <small class="text-muted">${new Date(post.created_at).toLocaleDateString()}</small>
                </div>
                ${mediaPreview}
                <p class="card-text">${post.wish_text}</p>
                <div class="d-flex justify-content-between align-items-center">
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-success" onclick="approvePost(${post.id})">
                            <i class="bi bi-check-circle"></i> Approve
                        </button>
                        <button class="btn btn-outline-danger" onclick="rejectPost(${post.id})">
                            <i class="bi bi-x-circle"></i> Reject
                        </button>
                    </div>
                    <small class="text-muted">
                        ${post.media_files ? post.media_files.length : 0} media files
                    </small>
                </div>
            </div>
        </div>
    `;
    
    return col;
}

// Load media files
async function loadMediaFiles() {
    try {
        const response = await fetch('/api/media-files/', {
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include'
        });
        
        if (response.ok) {
            mediaFiles = await response.json();
            displayMediaFiles();
        }
    } catch (error) {
        console.error('Error loading media files:', error);
    }
}

// Display media files
function displayMediaFiles() {
    const container = document.getElementById('mediaContainer');
    container.innerHTML = '';
    
    if (mediaFiles.length === 0) {
        container.innerHTML = `
            <div class="col-12 text-center">
                <p class="text-muted">No media files yet.</p>
            </div>
        `;
        return;
    }
    
    // Show only recent media files (limit to 8)
    const recentMedia = mediaFiles.slice(0, 8);
    
    recentMedia.forEach(media => {
        const mediaCard = createMediaCard(media);
        container.appendChild(mediaCard);
    });
}

// Create media card
function createMediaCard(media) {
    const col = document.createElement('div');
    col.className = 'col-lg-3 col-md-4 col-sm-6';
    
    const mediaIcon = media.media_type === 'photo' ? 'bi-image' : 'bi-camera-video';
    const mediaColor = media.media_type === 'photo' ? 'text-info' : 'text-warning';
    
    col.innerHTML = `
        <div class="card card-hover">
            <div class="card-body text-center">
                <i class="bi ${mediaIcon} ${mediaColor}" style="font-size: 2rem;"></i>
                <h6 class="card-title mt-2">${media.file_name}</h6>
                <p class="card-text text-muted">
                    <small>${media.media_type.charAt(0).toUpperCase() + media.media_type.slice(1)}</small>
                </p>
                <div class="d-flex justify-content-center gap-2">
                    <button class="btn btn-outline-success btn-sm" onclick="approveMedia(${media.id})">
                        <i class="bi bi-check-circle"></i>
                    </button>
                    <button class="btn btn-outline-danger btn-sm" onclick="rejectMedia(${media.id})">
                        <i class="bi bi-x-circle"></i>
                    </button>
                </div>
            </div>
        </div>
    `;
    
    return col;
}

// Create event
async function createEvent() {
    const form = document.getElementById('createEventForm');
    const formData = new FormData();
    
    formData.append('title', document.getElementById('eventTitle').value);
    formData.append('event_type_id', document.getElementById('eventType').value);
    formData.append('event_date', document.getElementById('eventDate').value);
    formData.append('location', document.getElementById('eventLocation').value);
    formData.append('description', document.getElementById('eventDescription').value);
    formData.append('allow_photos', document.getElementById('allowPhotos').checked);
    formData.append('allow_videos', document.getElementById('allowVideos').checked);
    formData.append('allow_wishes', document.getElementById('allowWishes').checked);
    formData.append('is_public', document.getElementById('isPublic').checked);
    
    const thumbnail = document.getElementById('eventThumbnail').files[0];
    if (thumbnail) {
        formData.append('event_thumbnail', thumbnail);
    }
    
    try {
        const response = await fetch('/api/events/', {
            method: 'POST',
            headers: {},
            body: formData,
            credentials: 'include'
        });
        
        if (response.ok) {
            const newEvent = await response.json();
            events.push(newEvent);
            displayEvents();
            updateDashboardStats();
            
            // Close modal and reset form
            bootstrap.Modal.getInstance(document.getElementById('createEventModal')).hide();
            form.reset();
            
            showAlert('Event created successfully!', 'success');
        } else {
            const error = await response.json();
            showAlert('Error creating event: ' + error.detail, 'danger');
        }
    } catch (error) {
        console.error('Error creating event:', error);
        showAlert('Error creating event', 'danger');
    }
}

// View event details
async function viewEventDetails(eventId) {
    try {
        const response = await fetch(`/api/events/${eventId}/`, {
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include'
        });
        
        if (response.ok) {
            const event = await response.json();
            const modal = new bootstrap.Modal(document.getElementById('eventDetailsModal'));
            document.getElementById('eventDetailsContent').innerHTML = createEventDetailsHTML(event);
            modal.show();
        }
    } catch (error) {
        console.error('Error loading event details:', error);
        showAlert('Error loading event details', 'danger');
    }
}

// Create event details HTML
function createEventDetailsHTML(event) {
    return `
        <div class="row">
            <div class="col-md-8">
                <h4>${event.title}</h4>
                <p class="text-muted">${event.description || 'No description'}</p>
                <div class="row mb-3">
                    <div class="col-6">
                        <strong>Event Date:</strong><br>
                        ${new Date(event.event_date).toLocaleDateString()}
                    </div>
                    <div class="col-6">
                        <strong>Location:</strong><br>
                        ${event.location || 'Not specified'}
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-6">
                        <strong>Status:</strong><br>
                        ${event.status}
                    </div>
                    <div class="col-6">
                        <strong>Payment Status:</strong><br>
                        ${event.payment_status}
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                ${event.event_thumbnail ? 
                    `<img src="${event.event_thumbnail}" class="img-fluid rounded" alt="Event thumbnail">` :
                    '<div class="bg-light rounded p-4 text-center"><i class="bi bi-calendar-event text-muted" style="font-size: 3rem;"></i></div>'
                }
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-12">
                <h5>Event Statistics</h5>
                <div class="row text-center">
                    <div class="col-3">
                        <div class="border rounded p-3">
                            <h4 class="text-primary">${event.total_guest_posts || 0}</h4>
                            <small>Guest Posts</small>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="border rounded p-3">
                            <h4 class="text-info">${event.total_media_files ? event.total_media_files.filter(m => m.media_type === 'photo').length : 0}</h4>
                            <small>Photos</small>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="border rounded p-3">
                            <h4 class="text-warning">${event.total_media_files ? event.total_media_files.filter(m => m.media_type === 'video').length : 0}</h4>
                            <small>Videos</small>
                        </div>
                    </div>
                    <div class="col-3">
                        <div class="border rounded p-3">
                            <h4 class="text-success">${event.is_live ? 'Yes' : 'No'}</h4>
                            <small>Live</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Approve post
async function approvePost(postId) {
    try {
        const response = await fetch(`/api/guest-posts/${postId}/approve/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include'
        });
        
        if (response.ok) {
            showAlert('Post approved successfully!', 'success');
            loadGuestPosts();
        } else {
            showAlert('Error approving post', 'danger');
        }
    } catch (error) {
        console.error('Error approving post:', error);
        showAlert('Error approving post', 'danger');
    }
}

// Reject post
async function rejectPost(postId) {
    try {
        const response = await fetch(`/api/guest-posts/${postId}/reject/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include'
        });
        
        if (response.ok) {
            showAlert('Post rejected successfully!', 'success');
            loadGuestPosts();
        } else {
            showAlert('Error rejecting post', 'danger');
        }
    } catch (error) {
        console.error('Error rejecting post:', error);
        showAlert('Error rejecting post', 'danger');
    }
}

// Approve media
async function approveMedia(mediaId) {
    try {
        const response = await fetch(`/api/media-files/${mediaId}/approve/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include'
        });
        
        if (response.ok) {
            showAlert('Media approved successfully!', 'success');
            loadMediaFiles();
        } else {
            showAlert('Error approving media', 'danger');
        }
    } catch (error) {
        console.error('Error approving media:', error);
        showAlert('Error approving media', 'danger');
    }
}

// Reject media
async function rejectMedia(mediaId) {
    try {
        const response = await fetch(`/api/media-files/${mediaId}/reject/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            credentials: 'include'
        });
        
        if (response.ok) {
            showAlert('Media rejected successfully!', 'success');
            loadMediaFiles();
        } else {
            showAlert('Error rejecting media', 'danger');
        }
    } catch (error) {
        console.error('Error rejecting media:', error);
        showAlert('Error rejecting media', 'danger');
    }
}

// View event gallery
function viewEventGallery(eventId) {
    // Redirect to gallery page or open in modal
    window.open(`/api/events/${eventId}/gallery/`, '_blank');
}

// Utility functions
function getAuthToken() {
    // For session-based authentication, we don't need tokens
    // The browser will automatically send cookies with requests
    return null;
}

function showAlert(message, type) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    alertDiv.style.top = '20px';
    alertDiv.style.right = '20px';
    alertDiv.style.zIndex = '9999';
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.remove();
        }
    }, 5000);
}

function logout() {
    // Use JWT logout function instead of session-based logout
    logoutUser();
}
</script>

<!-- Include auth.js for JWT logout functionality -->
<script src="../../neberku-frontend/js/config.js"></script>
<script src="../../neberku-frontend/js/auth.js"></script>
{% endblock %} 